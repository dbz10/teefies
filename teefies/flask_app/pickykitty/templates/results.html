{% extends "layout.html" %}

{% block head %}
{{ super() }}
{% endblock %}

{% block title %} PickyKitty {% endblock %}

{% block content %}


<br><br>

    

   

    </div> <!-- /.container-->

    <div class="container">
      <div class="starter-template">
        <h3>Results:</h3>
        <p class="lead">You said your kitty liked {{liked}}, and disliked {{disliked}}.</p>
        <p class="lead"> The crystal ball suggests...</p>
      </div>

      <table class="table table-hover" style="width:100%" id = 'results_table'>
        <thead>
          <tr>
            <th scope="col"></th>
            <th scope="col">Food</th> 
            <th scope="col">Price </th>
            <th scope="col">Buy it</th>
          </tr>
        </thead>
        <tbody>
        {% for item in output %}
        <tr>
          <th scope="row"> {{ loop.index }} </th>
          <td>{{ item['name'] }}</td>
          <td class = "price">{{item['price']}}</td> 
          <td><a href="{{ item['url'] }}" target="_blank">Take me there!</a> </td>
        </tr>
        </tbody>
      {% endfor %}
      </table>

      {% if allergens %}
      <div class='container'>
        <form method='POST'>
        {% for allergen in allergens%}
        <span> 
          <!-- {{allergen}}  -->
          <div class="custom-control custom-checkbox custom-control-inline">
            <input type="checkbox" class="custom-control-input custom-control-inline" 
            id="customCheck{{loop.index}}" name='allergen_checkbox' value='{{allergen}}'
            >
            <label class="custom-control-label" for="customCheck{{loop.index}}"> {{allergen}} </label>
          </div>

        <!--   <input type="checkbox" class="custom-control-input" name='allergen_checkbox' value='{{allergen}}' > </span> -->
        {% endfor %}
        <button type="submit" class = 'btn btn-primary'> Filter </button>
      </form>
      </div>
      {% endif %}


     </div><!-- /.container -->

     <br><br>
     <div class="container">
      <div class="starter-template">


        <h2>Try again with a different set of foods</h2>
        <form action="/">
          <button type='submit' class='btn btn-dark btn=lg'>Let's go!</button>
        </form>
    </div>
  </div>

      {% for item in output %}
        <div class="mytooltip" id='tooltip-{{loop.index}}'> Price per oz: {{item['price_per_oz']}} </div>
      {% endfor %}

      <script src="https://code.jquery.com/jquery-1.10.2.min.js"></script>
      <script src="../static/js/bootstrap.min.js"></script>

      <script>
        const table = document.getElementById('results_table')
        const rows = table.querySelectorAll("td.price")
        const tooltips = document.querySelectorAll('.mytooltip')
        console.log(tooltips)

        rows.forEach( (row,i) => {
          row.addEventListener('mouseover',function(e){
            const tip = document.getElementById(`tooltip-${i+1}`)
            console.log(tip)

            const { top, left } = this.getBoundingClientRect()

            tip.style.display = 'inline-block'
            tip.style.left = (Number(left)+50)+'px'
            tip.style.top = (Number(top)-20)+'px'


          })

          row.addEventListener('mouseout',function(e){
            const tip = document.getElementById(`tooltip-${i+1}`)
            tip.style.display = 'none'
          })

        })


      </script>



     </div><!-- /.container -->


    <!-- Bootstrap core JavaScript
    ================================================== -->
    <!-- Placed at the end of the document so the pages load faster -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.4/jquery.min.js"></script>
    <script>window.jQuery || document.write('<script src="../../assets/js/vendor/jquery.min.js"><\/script>')</script>
    <script src="static/js/bootstrap.min.js"></script>


{% endblock %}